<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programación Asíncrona - Academia de Programación</title>
    <meta name="description" content="Aprende programación asíncrona en JavaScript: callbacks, promesas, async/await, Fetch API y manejo de errores.">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <!-- Header con navegación -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <i class="fab fa-js-square"></i>
                <span>JS Academy</span>
            </div>
            <ul class="nav-menu">
                <li><a href="./index.html" class="nav-link">Inicio</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
    </header>

    <!-- Breadcrumbs -->
    <nav class="breadcrumb" id="breadcrumb">
        <ol class="breadcrumb-list">
            <li class="breadcrumb-item">
                <a href="./index.html"><i class="fas fa-home"></i> Inicio</a>
            </li>
            <li class="breadcrumb-item">
                <a href="index.html#modulos">Módulos</a>
            </li>
            <li class="breadcrumb-item active" id="current-page">Programación Asíncrona</li>
        </ol>
    </nav>

    <!-- Barra de Progreso -->
    <section class="progress-bar-section">
        <div class="container">
            <div class="progress-container">
                <div class="progress-info">
                    <i class="fas fa-chart-line"></i>
                    <span class="progress-label">Progreso del Módulo</span>
                    <span class="progress-percentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="moduleProgress"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Hero del Módulo -->
    <section class="module-hero">
        <div class="container">
            <div class="module-header">
                <div class="module-badge">
                    <i class="fas fa-clock"></i>
                    <span>Módulo 4</span>
                </div>
                <h1>Programación Asíncrona</h1>
                <p class="module-description">
                    Domina la programación asíncrona en JavaScript. Aprende callbacks, promesas, async/await, 
                    Fetch API y cómo manejar operaciones que toman tiempo.
                </p>
                <div class="module-meta">
                    <div class="meta-item">
                        <i class="fas fa-clock"></i>
                        <span>6-8 horas</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-code"></i>
                        <span>25+ ejemplos</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-star"></i>
                        <span>Avanzado</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Navegación del Módulo -->
    <section class="module-nav">
        <div class="container">
            <div class="module-nav-content">
                <h3>📚 Lecciones del Módulo</h3>
                <div class="module-nav-list">
                    <a href="#callbacks" class="nav-item" data-section="callbacks">
                        <div class="nav-item-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="nav-item-content">
                            <span class="nav-item-title">Callbacks</span>
                            <span class="nav-item-desc">Funciones que se ejecutan después</span>
                        </div>
                        <div class="nav-item-status">
                            <i class="far fa-circle"></i>
                        </div>
                    </a>
                    <a href="#promises" class="nav-item" data-section="promises">
                        <div class="nav-item-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="nav-item-content">
                            <span class="nav-item-title">Promesas</span>
                            <span class="nav-item-desc">Manejo moderno de asincronía</span>
                        </div>
                        <div class="nav-item-status">
                            <i class="far fa-circle"></i>
                        </div>
                    </a>
                    <a href="#async-await" class="nav-item" data-section="async-await">
                        <div class="nav-item-icon">
                            <i class="fas fa-magic"></i>
                        </div>
                        <div class="nav-item-content">
                            <span class="nav-item-title">Async/Await</span>
                            <span class="nav-item-desc">Sintaxis moderna y limpia</span>
                        </div>
                        <div class="nav-item-status">
                            <i class="far fa-circle"></i>
                        </div>
                    </a>
                    <a href="#fetch-api" class="nav-item" data-section="fetch-api">
                        <div class="nav-item-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="nav-item-content">
                            <span class="nav-item-title">Fetch API</span>
                            <span class="nav-item-desc">Peticiones HTTP modernas</span>
                        </div>
                        <div class="nav-item-status">
                            <i class="far fa-circle"></i>
                        </div>
                    </a>
                    <a href="#error-handling" class="nav-item" data-section="error-handling">
                        <div class="nav-item-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="nav-item-content">
                            <span class="nav-item-title">Manejo de Errores</span>
                            <span class="nav-item-desc">Try/catch y manejo de fallos</span>
                        </div>
                        <div class="nav-item-status">
                            <i class="far fa-circle"></i>
                        </div>
                    </a>
                    <a href="#timers" class="nav-item" data-section="timers">
                        <div class="nav-item-icon">
                            <i class="fas fa-stopwatch"></i>
                        </div>
                        <div class="nav-item-content">
                            <span class="nav-item-title">Timers</span>
                            <span class="nav-item-desc">setTimeout, setInterval</span>
                        </div>
                        <div class="nav-item-status">
                            <i class="far fa-circle"></i>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Lección 1: Callbacks -->
    <section id="callbacks" class="lesson-section" data-lesson="callbacks">
        <div class="container">
            <div class="lesson-header">
                <div class="lesson-badge">
                    <i class="fas fa-phone"></i>
                    <span>Lección 1</span>
                </div>
                <h2>Callbacks</h2>
                <p class="lesson-intro">Los callbacks son funciones que se pasan como argumentos y se ejecutan después de que otra función termine.</p>
                
                <div class="key-points">
                    <h4>🎯 Puntos Clave</h4>
                    <div class="key-points-grid">
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>Funciones como argumentos</span>
                        </div>
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>Ejecución diferida</span>
                        </div>
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>Callback hell</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lesson-content">
                <div class="theory-section">
                    <div class="section-toggle" onclick="toggleSection('callbacks-theory')">
                        <h3><i class="fas fa-book"></i> Teoría</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div id="callbacks-theory" class="theory-content">
                        <div class="theory-grid">
                            <div class="theory-card">
                                <h4><i class="fas fa-phone"></i> ¿Qué son los Callbacks?</h4>
                                <div class="theory-list">
                                    <div class="theory-item">
                                        <code>function callback()</code>
                                        <span>Función que se ejecuta después</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>setTimeout(callback, 1000)</code>
                                        <span>Ejemplo común de callback</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>array.map(callback)</code>
                                        <span>Callback en métodos de array</span>
                                    </div>
                                </div>
                            </div>

                            <div class="theory-card">
                                <h4><i class="fas fa-exclamation-triangle"></i> Problemas</h4>
                                <div class="theory-list">
                                    <div class="theory-item">
                                        <code>Callback Hell</code>
                                        <span>Callbacks anidados difíciles de leer</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>Error Handling</code>
                                        <span>Manejo de errores complejo</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>Debugging</code>
                                        <span>Difícil de debuggear</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="example-section">
                    <div class="section-toggle" onclick="toggleSection('callbacks-example')">
                        <h3><i class="fas fa-code"></i> Ejemplo Práctico</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div id="callbacks-example" class="example-content collapsed">
                        <div class="example-tabs">
                            <button class="tab-btn active" onclick="showExampleTab('callbacks', 'basic')">Básico</button>
                            <button class="tab-btn" onclick="showExampleTab('callbacks', 'advanced')">Avanzado</button>
                            <button class="tab-btn" onclick="showExampleTab('callbacks', 'interactive')">Interactivo</button>
                        </div>

                        <div id="callbacks-basic" class="example-tab-content active">
                            <div class="code-example">
                                <div class="code-header">
                                    <span class="code-title">Callbacks Básicos</span>
                                    <button class="btn btn-sm btn-primary" onclick="runCode('callbacks-basic-code')">
                                        <i class="fas fa-play"></i> Ejecutar
                                    </button>
                                </div>
                                <div class="code-block">
                                    <pre><code class="language-javascript" id="callbacks-basic-code">// Función que simula una operación asíncrona
function simularOperacion(tiempo, callback) {
    setTimeout(() => {
        const resultado = `Operación completada en ${tiempo}ms`;
        callback(null, resultado);
    }, tiempo);
}

// Función callback
function manejarResultado(error, resultado) {
    if (error) {
        console.log('Error:', error);
    } else {
        console.log('Resultado:', resultado);
    }
}

// Usar el callback
simularOperacion(1000, manejarResultado);

// Callback con arrow function
simularOperacion(500, (error, resultado) => {
    if (error) {
        console.log('Error:', error);
    } else {
        console.log('Resultado con arrow function:', resultado);
    }
});

// Callback en métodos de array
const numeros = [1, 2, 3, 4, 5];
const duplicados = numeros.map(numero => numero * 2);
console.log('Números duplicados:', duplicados);

// Callback con filter
const pares = numeros.filter(numero => numero % 2 === 0);
console.log('Números pares:', pares);</code></pre>
                                </div>
                                <div class="code-output" id="callbacks-basic-output"></div>
                            </div>
                        </div>

                        <div id="callbacks-advanced" class="example-tab-content">
                            <div class="code-example">
                                <div class="code-header">
                                    <span class="code-title">Callback Hell</span>
                                    <button class="btn btn-sm btn-primary" onclick="runCode('callbacks-advanced-code')">
                                        <i class="fas fa-play"></i> Ejecutar
                                    </button>
                                </div>
                                <div class="code-block">
                                    <pre><code class="language-javascript" id="callbacks-advanced-code">// Simular operaciones asíncronas
function obtenerUsuario(id, callback) {
    setTimeout(() => {
        const usuario = { id, nombre: `Usuario ${id}`, email: `user${id}@email.com` };
        callback(null, usuario);
    }, 1000);
}

function obtenerPosts(usuarioId, callback) {
    setTimeout(() => {
        const posts = [
            { id: 1, titulo: `Post 1 del usuario ${usuarioId}` },
            { id: 2, titulo: `Post 2 del usuario ${usuarioId}` }
        ];
        callback(null, posts);
    }, 800);
}

function obtenerComentarios(postId, callback) {
    setTimeout(() => {
        const comentarios = [
            { id: 1, texto: `Comentario 1 del post ${postId}` },
            { id: 2, texto: `Comentario 2 del post ${postId}` }
        ];
        callback(null, comentarios);
    }, 600);
}

// Callback Hell - difícil de leer y mantener
console.log('Iniciando operaciones...');

obtenerUsuario(1, (error, usuario) => {
    if (error) {
        console.log('Error obteniendo usuario:', error);
        return;
    }
    
    console.log('Usuario obtenido:', usuario);
    
    obtenerPosts(usuario.id, (error, posts) => {
        if (error) {
            console.log('Error obteniendo posts:', error);
            return;
        }
        
        console.log('Posts obtenidos:', posts);
        
        obtenerComentarios(posts[0].id, (error, comentarios) => {
            if (error) {
                console.log('Error obteniendo comentarios:', error);
                return;
            }
            
            console.log('Comentarios obtenidos:', comentarios);
            console.log('¡Todas las operaciones completadas!');
        });
    });
});

console.log('Este mensaje se ejecuta inmediatamente (no espera)');</code></pre>
                                </div>
                                <div class="code-output" id="callbacks-advanced-output"></div>
                            </div>
                        </div>

                        <div id="callbacks-interactive" class="example-tab-content">
                            <div class="interactive-example">
                                <h4>🎮 Simulador de Callbacks</h4>
                                <div class="interactive-content">
                                    <div class="input-group">
                                        <label>Operación:</label>
                                        <select id="interactive-operation">
                                            <option value="sum">Sumar números</option>
                                            <option value="multiply">Multiplicar números</option>
                                            <option value="filter">Filtrar pares</option>
                                            <option value="async">Operación asíncrona</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label>Números (separados por comas):</label>
                                        <input type="text" id="interactive-numbers" placeholder="1,2,3,4,5" value="1,2,3,4,5">
                                    </div>
                                    <button class="btn btn-primary" onclick="executeCallback()">
                                        <i class="fas fa-play"></i> Ejecutar Callback
                                    </button>
                                    <div class="interactive-output" id="interactive-output"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lesson-summary">
                    <h4>📝 Resumen</h4>
                    <div class="summary-content">
                        <p>En esta lección aprendiste sobre:</p>
                        <ul>
                            <li>Qué son los callbacks y cómo funcionan</li>
                            <li>Cómo usar callbacks en operaciones asíncronas</li>
                            <li>El problema del "Callback Hell"</li>
                            <li>Por qué necesitamos alternativas modernas</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Lección 2: Promesas -->
    <section id="promises" class="lesson-section bg-light" data-lesson="promises">
        <div class="container">
            <div class="lesson-header">
                <div class="lesson-badge">
                    <i class="fas fa-handshake"></i>
                    <span>Lección 2</span>
                </div>
                <h2>Promesas</h2>
                <p class="lesson-intro">Las promesas son una forma más elegante de manejar operaciones asíncronas, evitando el callback hell.</p>
                
                <div class="key-points">
                    <h4>🎯 Puntos Clave</h4>
                    <div class="key-points-grid">
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>Estados: pending, fulfilled, rejected</span>
                        </div>
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>then() y catch()</span>
                        </div>
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>Promise.all() y Promise.race()</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lesson-content">
                <div class="theory-section">
                    <div class="section-toggle" onclick="toggleSection('promises-theory')">
                        <h3><i class="fas fa-book"></i> Teoría</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div id="promises-theory" class="theory-content">
                        <div class="theory-grid">
                            <div class="theory-card">
                                <h4><i class="fas fa-handshake"></i> Estados de una Promesa</h4>
                                <div class="theory-list">
                                    <div class="theory-item">
                                        <code>pending</code>
                                        <span>Estado inicial, ni cumplida ni rechazada</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>fulfilled</code>
                                        <span>Operación completada exitosamente</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>rejected</code>
                                        <span>Operación falló</span>
                                    </div>
                                </div>
                            </div>

                            <div class="theory-card">
                                <h4><i class="fas fa-cogs"></i> Métodos de Promesas</h4>
                                <div class="theory-list">
                                    <div class="theory-item">
                                        <code>then()</code>
                                        <span>Maneja el éxito</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>catch()</code>
                                        <span>Maneja errores</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>finally()</code>
                                        <span>Se ejecuta siempre</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="example-section">
                    <div class="section-toggle" onclick="toggleSection('promises-example')">
                        <h3><i class="fas fa-code"></i> Ejemplo Práctico</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div id="promises-example" class="example-content collapsed">
                        <div class="example-tabs">
                            <button class="tab-btn active" onclick="showExampleTab('promises', 'basic')">Básico</button>
                            <button class="tab-btn" onclick="showExampleTab('promises', 'advanced')">Avanzado</button>
                            <button class="tab-btn" onclick="showExampleTab('promises', 'interactive')">Interactivo</button>
                        </div>

                        <div id="promises-basic" class="example-tab-content active">
                            <div class="code-example">
                                <div class="code-header">
                                    <span class="code-title">Promesas Básicas</span>
                                    <button class="btn btn-sm btn-primary" onclick="runCode('promises-basic-code')">
                                        <i class="fas fa-play"></i> Ejecutar
                                    </button>
                                </div>
                                <div class="code-block">
                                    <pre><code class="language-javascript" id="promises-basic-code">// Crear una promesa
function crearPromesa(exito = true, tiempo = 1000) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            if (exito) {
                resolve(`Operación exitosa en ${tiempo}ms`);
            } else {
                reject(new Error(`Operación falló en ${tiempo}ms`));
            }
        }, tiempo);
    });
}

// Usar la promesa
console.log('Iniciando promesa...');

crearPromesa(true, 1000)
    .then(resultado => {
        console.log('Éxito:', resultado);
        return 'Procesando resultado...';
    })
    .then(procesado => {
        console.log('Procesado:', procesado);
    })
    .catch(error => {
        console.log('Error:', error.message);
    })
    .finally(() => {
        console.log('Promesa finalizada');
    });

// Promesa que falla
crearPromesa(false, 500)
    .then(resultado => {
        console.log('Este no se ejecutará');
    })
    .catch(error => {
        console.log('Error capturado:', error.message);
    });

console.log('Este mensaje se ejecuta inmediatamente');</code></pre>
                                </div>
                                <div class="code-output" id="promises-basic-output"></div>
                            </div>
                        </div>

                        <div id="promises-advanced" class="example-tab-content">
                            <div class="code-example">
                                <div class="code-header">
                                    <span class="code-title">Promise.all() y Promise.race()</span>
                                    <button class="btn btn-sm btn-primary" onclick="runCode('promises-advanced-code')">
                                        <i class="fas fa-play"></i> Ejecutar
                                    </button>
                                </div>
                                <div class="code-block">
                                    <pre><code class="language-javascript" id="promises-advanced-code">// Función para simular operaciones
function simularOperacion(nombre, tiempo, exito = true) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            if (exito) {
                resolve(`${nombre} completada en ${tiempo}ms`);
            } else {
                reject(new Error(`${nombre} falló`));
            }
        }, tiempo);
    });
}

// Promise.all() - espera a que todas se completen
console.log('=== Promise.all() ===');
const promesas = [
    simularOperacion('Operación A', 1000),
    simularOperacion('Operación B', 1500),
    simularOperacion('Operación C', 800)
];

Promise.all(promesas)
    .then(resultados => {
        console.log('Todas las operaciones completadas:');
        resultados.forEach(resultado => console.log('-', resultado));
    })
    .catch(error => {
        console.log('Alguna operación falló:', error.message);
    });

// Promise.race() - devuelve la primera que se complete
console.log('\n=== Promise.race() ===');
const promesasRace = [
    simularOperacion('Carrera A', 2000),
    simularOperacion('Carrera B', 1000),
    simularOperacion('Carrera C', 1500)
];

Promise.race(promesasRace)
    .then(resultado => {
        console.log('Primera en completarse:', resultado);
    })
    .catch(error => {
        console.log('Primera en fallar:', error.message);
    });

// Promise.allSettled() - espera todas, exitosas o no
console.log('\n=== Promise.allSettled() ===');
const promesasSettled = [
    simularOperacion('Settled A', 1000, true),
    simularOperacion('Settled B', 1200, false),
    simularOperacion('Settled C', 800, true)
];

Promise.allSettled(promesasSettled)
    .then(resultados => {
        console.log('Todas las promesas finalizadas:');
        resultados.forEach((resultado, index) => {
            if (resultado.status === 'fulfilled') {
                console.log(`- ${index + 1}: Éxito - ${resultado.value}`);
            } else {
                console.log(`- ${index + 1}: Error - ${resultado.reason.message}`);
            }
        });
    });</code></pre>
                                </div>
                                <div class="code-output" id="promises-advanced-output"></div>
                            </div>
                        </div>

                        <div id="promises-interactive" class="example-tab-content">
                            <div class="interactive-example">
                                <h4>🎮 Constructor de Promesas</h4>
                                <div class="interactive-content">
                                    <div class="input-group">
                                        <label>Nombre de la operación:</label>
                                        <input type="text" id="interactive-operation-name" placeholder="Mi Operación" value="Mi Operación">
                                    </div>
                                    <div class="input-group">
                                        <label>Tiempo (ms):</label>
                                        <input type="number" id="interactive-time" placeholder="1000" value="1000">
                                    </div>
                                    <div class="input-group">
                                        <label>¿Éxito?</label>
                                        <select id="interactive-success">
                                            <option value="true">Sí</option>
                                            <option value="false">No</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary" onclick="createPromise()">
                                        <i class="fas fa-magic"></i> Crear Promesa
                                    </button>
                                    <div class="interactive-output" id="interactive-output"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lesson-summary">
                    <h4>📝 Resumen</h4>
                    <div class="summary-content">
                        <p>En esta lección aprendiste sobre:</p>
                        <ul>
                            <li>Los tres estados de una promesa: pending, fulfilled, rejected</li>
                            <li>Cómo usar <code>then()</code>, <code>catch()</code> y <code>finally()</code></li>
                            <li>Métodos estáticos como <code>Promise.all()</code> y <code>Promise.race()</code></li>
                            <li>Cómo las promesas mejoran el manejo de código asíncrono</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Lección 3: Async/Await -->
    <section id="async-await" class="lesson-section" data-lesson="async-await">
        <div class="container">
            <div class="lesson-header">
                <div class="lesson-badge">
                    <i class="fas fa-magic"></i>
                    <span>Lección 3</span>
                </div>
                <h2>Async/Await</h2>
                <p class="lesson-intro">La sintaxis más moderna y limpia para trabajar con promesas, haciendo el código asíncrono más legible.</p>
                
                <div class="key-points">
                    <h4>🎯 Puntos Clave</h4>
                    <div class="key-points-grid">
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>Sintaxis síncrona para código asíncrono</span>
                        </div>
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>await solo en funciones async</span>
                        </div>
                        <div class="key-point">
                            <i class="fas fa-lightbulb"></i>
                            <span>Manejo de errores con try/catch</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lesson-content">
                <div class="theory-section">
                    <div class="section-toggle" onclick="toggleSection('async-await-theory')">
                        <h3><i class="fas fa-book"></i> Teoría</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div id="async-await-theory" class="theory-content">
                        <div class="theory-grid">
                            <div class="theory-card">
                                <h4><i class="fas fa-magic"></i> Sintaxis Async/Await</h4>
                                <div class="theory-list">
                                    <div class="theory-item">
                                        <code>async function</code>
                                        <span>Declara función asíncrona</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>await promesa</code>
                                        <span>Espera a que se resuelva</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>try/catch</code>
                                        <span>Manejo de errores</span>
                                    </div>
                                </div>
                            </div>

                            <div class="theory-card">
                                <h4><i class="fas fa-star"></i> Ventajas</h4>
                                <div class="theory-list">
                                    <div class="theory-item">
                                        <code>Legibilidad</code>
                                        <span>Código más fácil de leer</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>Debugging</code>
                                        <span>Más fácil de debuggear</span>
                                    </div>
                                    <div class="theory-item">
                                        <code>Mantenimiento</code>
                                        <span>Fácil de mantener</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="example-section">
                    <div class="section-toggle" onclick="toggleSection('async-await-example')">
                        <h3><i class="fas fa-code"></i> Ejemplo Práctico</h3>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                    <div id="async-await-example" class="example-content collapsed">
                        <div class="example-tabs">
                            <button class="tab-btn active" onclick="showExampleTab('async-await', 'basic')">Básico</button>
                            <button class="tab-btn" onclick="showExampleTab('async-await', 'advanced')">Avanzado</button>
                            <button class="tab-btn" onclick="showExampleTab('async-await', 'interactive')">Interactivo</button>
                        </div>

                        <div id="async-await-basic" class="example-tab-content active">
                            <div class="code-example">
                                <div class="code-header">
                                    <span class="code-title">Async/Await Básico</span>
                                    <button class="btn btn-sm btn-primary" onclick="runCode('async-await-basic-code')">
                                        <i class="fas fa-play"></i> Ejecutar
                                    </button>
                                </div>
                                <div class="code-block">
                                    <pre><code class="language-javascript" id="async-await-basic-code">// Función que simula operación asíncrona
function simularOperacion(nombre, tiempo) {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve(`${nombre} completada en ${tiempo}ms`);
        }, tiempo);
    });
}

// Función async básica
async function operacionBasica() {
    console.log('Iniciando operación...');
    
    try {
        const resultado = await simularOperacion('Operación A', 1000);
        console.log('Resultado:', resultado);
        
        const resultado2 = await simularOperacion('Operación B', 500);
        console.log('Resultado 2:', resultado2);
        
        return 'Todas las operaciones completadas';
    } catch (error) {
        console.log('Error:', error.message);
        throw error;
    }
}

// Llamar la función async
operacionBasica()
    .then(resultado => {
        console.log('Final:', resultado);
    })
    .catch(error => {
        console.log('Error final:', error.message);
    });

// Arrow function async
const operacionArrow = async () => {
    console.log('Operación con arrow function...');
    const resultado = await simularOperacion('Arrow Operation', 800);
    console.log('Resultado arrow:', resultado);
};

operacionArrow();

console.log('Este mensaje se ejecuta inmediatamente');</code></pre>
                                </div>
                                <div class="code-output" id="async-await-basic-output"></div>
                            </div>
                        </div>

                        <div id="async-await-advanced" class="example-tab-content">
                            <div class="code-example">
                                <div class="code-header">
                                    <span class="code-title">Async/Await Avanzado</span>
                                    <button class="btn btn-sm btn-primary" onclick="runCode('async-await-advanced-code')">
                                        <i class="fas fa-play"></i> Ejecutar
                                    </button>
                                </div>
                                <div class="code-block">
                                    <pre><code class="language-javascript" id="async-await-advanced-code">// Simular API calls
function obtenerUsuario(id) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            if (id > 0) {
                resolve({ id, nombre: `Usuario ${id}`, email: `user${id}@email.com` });
            } else {
                reject(new Error('ID de usuario inválido'));
            }
        }, 1000);
    });
}

function obtenerPosts(usuarioId) {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve([
                { id: 1, titulo: `Post 1 del usuario ${usuarioId}` },
                { id: 2, titulo: `Post 2 del usuario ${usuarioId}` }
            ]);
        }, 800);
    });
}

function obtenerComentarios(postId) {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve([
                { id: 1, texto: `Comentario 1 del post ${postId}` },
                { id: 2, texto: `Comentario 2 del post ${postId}` }
            ]);
        }, 600);
    });
}

// Función async que maneja todo el flujo
async function obtenerDatosCompletos(usuarioId) {
    try {
        console.log('Obteniendo datos del usuario...');
        
        // Obtener usuario
        const usuario = await obtenerUsuario(usuarioId);
        console.log('Usuario obtenido:', usuario);
        
        // Obtener posts del usuario
        const posts = await obtenerPosts(usuario.id);
        console.log('Posts obtenidos:', posts);
        
        // Obtener comentarios del primer post
        const comentarios = await obtenerComentarios(posts[0].id);
        console.log('Comentarios obtenidos:', comentarios);
        
        // Retornar datos completos
        return {
            usuario,
            posts,
            comentarios
        };
        
    } catch (error) {
        console.log('Error en obtenerDatosCompletos:', error.message);
        throw error;
    }
}

// Función para operaciones paralelas
async function operacionesParalelas() {
    try {
        console.log('Ejecutando operaciones en paralelo...');
        
        // Ejecutar múltiples operaciones en paralelo
        const [usuario1, usuario2, usuario3] = await Promise.all([
            obtenerUsuario(1),
            obtenerUsuario(2),
            obtenerUsuario(3)
        ]);
        
        console.log('Usuarios obtenidos en paralelo:');
        console.log('- Usuario 1:', usuario1.nombre);
        console.log('- Usuario 2:', usuario2.nombre);
        console.log('- Usuario 3:', usuario3.nombre);
        
    } catch (error) {
        console.log('Error en operaciones paralelas:', error.message);
    }
}

// Ejecutar las funciones
obtenerDatosCompletos(1)
    .then(datos => {
        console.log('Datos completos obtenidos:', datos);
    })
    .catch(error => {
        console.log('Error final:', error.message);
    });

operacionesParalelas();</code></pre>
                                </div>
                                <div class="code-output" id="async-await-advanced-output"></div>
                            </div>
                        </div>

                        <div id="async-await-interactive" class="example-tab-content">
                            <div class="interactive-example">
                                <h4>🎮 Simulador de Async/Await</h4>
                                <div class="interactive-content">
                                    <div class="input-group">
                                        <label>Número de operaciones:</label>
                                        <select id="interactive-operations-count">
                                            <option value="1">1 operación</option>
                                            <option value="2">2 operaciones</option>
                                            <option value="3">3 operaciones</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label>Tipo de ejecución:</label>
                                        <select id="interactive-execution-type">
                                            <option value="sequential">Secuencial</option>
                                            <option value="parallel">Paralelo</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary" onclick="simulateAsyncAwait()">
                                        <i class="fas fa-play"></i> Simular Async/Await
                                    </button>
                                    <div class="interactive-output" id="interactive-output"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lesson-summary">
                    <h4>📝 Resumen</h4>
                    <div class="summary-content">
                        <p>En esta lección aprendiste sobre:</p>
                        <ul>
                            <li>Cómo usar <code>async</code> y <code>await</code> para código más limpio</li>
                            <li>El manejo de errores con <code>try/catch</code> en funciones async</li>
                            <li>La diferencia entre ejecución secuencial y paralela</li>
                            <li>Cómo combinar async/await con <code>Promise.all()</code></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Ejercicios Prácticos -->
    <section class="exercises-section">
        <div class="container">
            <h2>💪 Ejercicios Prácticos</h2>
            <p class="section-description">Pon a prueba tus conocimientos de programación asíncrona con estos ejercicios prácticos.</p>
            
            <div class="exercises-grid">
                <div class="exercise-card">
                    <div class="exercise-header">
                        <h3>Clima App con Fetch</h3>
                        <span class="difficulty intermediate">Intermedio</span>
                    </div>
                    <div class="exercise-content">
                        <p>Crea una aplicación que obtenga datos del clima usando la Fetch API.</p>
                        <div class="exercise-requirements">
                            <h4>Requisitos:</h4>
                            <ul>
                                <li>Usar Fetch API para obtener datos</li>
                                <li>Manejar errores con try/catch</li>
                                <li>Mostrar loading state</li>
                                <li>Actualizar UI con los datos</li>
                            </ul>
                        </div>
                        <button class="btn btn-outline" onclick="toggleCode('exercise1-solution')">
                            <i class="fas fa-eye"></i> Ver Solución
                        </button>
                        <div id="exercise1-solution" class="code-block" style="display: none;">
                            <pre><code class="language-javascript">// Función para obtener datos del clima
async function obtenerClima(ciudad) {
    try {
        // Mostrar loading
        console.log('Obteniendo datos del clima...');
        
        // Simular API call (en la práctica usarías una API real)
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${ciudad}&appid=TU_API_KEY`);
        
        if (!response.ok) {
            throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        
        return {
            ciudad: data.name,
            temperatura: Math.round(data.main.temp - 273.15), // Convertir de Kelvin a Celsius
            descripcion: data.weather[0].description,
            humedad: data.main.humidity,
            viento: data.wind.speed
        };
        
    } catch (error) {
        console.error('Error obteniendo clima:', error);
        throw error;
    }
}

// Función para mostrar el clima en la UI
function mostrarClima(datosClima) {
    const climaDiv = document.createElement('div');
    climaDiv.innerHTML = `
        <div style="border: 1px solid #ccc; padding: 20px; margin: 10px; border-radius: 10px; background: #f9f9f9;">
            <h3>Clima en ${datosClima.ciudad}</h3>
            <p><strong>Temperatura:</strong> ${datosClima.temperatura}°C</p>
            <p><strong>Descripción:</strong> ${datosClima.descripcion}</p>
            <p><strong>Humedad:</strong> ${datosClima.humedad}%</p>
            <p><strong>Viento:</strong> ${datosClima.viento} m/s</p>
        </div>
    `;
    document.body.appendChild(climaDiv);
}

// Función principal
async function appClima() {
    const ciudades = ['Madrid', 'Barcelona', 'Valencia'];
    
    try {
        // Obtener clima para todas las ciudades en paralelo
        const promesasClima = ciudades.map(ciudad => obtenerClima(ciudad));
        const datosClima = await Promise.all(promesasClima);
        
        // Mostrar todos los datos
        datosClima.forEach(mostrarClima);
        
        console.log('Datos del clima obtenidos exitosamente');
        
    } catch (error) {
        console.error('Error en la aplicación:', error);
        
        // Mostrar mensaje de error
        const errorDiv = document.createElement('div');
        errorDiv.innerHTML = `
            <div style="border: 1px solid #dc3545; padding: 20px; margin: 10px; border-radius: 10px; background: #f8d7da; color: #721c24;">
                <h3>Error</h3>
                <p>No se pudieron obtener los datos del clima: ${error.message}</p>
            </div>
        `;
        document.body.appendChild(errorDiv);
    }
}

// Ejecutar la aplicación
appClima();</code></pre>
                        </div>
                    </div>
                </div>

                <div class="exercise-card">
                    <div class="exercise-header">
                        <h3>Task Manager Asíncrono</h3>
                        <span class="difficulty advanced">Avanzado</span>
                    </div>
                    <div class="exercise-content">
                        <p>Crea un gestor de tareas que use operaciones asíncronas para simular persistencia.</p>
                        <div class="exercise-requirements">
                            <h4>Requisitos:</h4>
                            <ul>
                                <li>CRUD asíncrono de tareas</li>
                                <li>Simular delay de base de datos</li>
                                <li>Manejo de errores robusto</li>
                                <li>Loading states</li>
                                <li>Operaciones en lote</li>
                            </ul>
                        </div>
                        <button class="btn btn-outline" onclick="toggleCode('exercise2-solution')">
                            <i class="fas fa-eye"></i> Ver Solución
                        </button>
                        <div id="exercise2-solution" class="code-block" style="display: none;">
                            <pre><code class="language-javascript">// Simular base de datos
let tareas = [
    { id: 1, titulo: 'Aprender JavaScript', completada: false },
    { id: 2, titulo: 'Hacer ejercicio', completada: true },
    { id: 3, titulo: 'Leer un libro', completada: false }
];

let nextId = 4;

// Simular delay de base de datos
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// API asíncrona para tareas
const taskAPI = {
    // Obtener todas las tareas
    async obtenerTodas() {
        await delay(500);
        return [...tareas];
    },
    
    // Obtener tarea por ID
    async obtenerPorId(id) {
        await delay(300);
        const tarea = tareas.find(t => t.id === id);
        if (!tarea) {
            throw new Error(`Tarea con ID ${id} no encontrada`);
        }
        return tarea;
    },
    
    // Crear nueva tarea
    async crear(titulo) {
        await delay(400);
        const nuevaTarea = {
            id: nextId++,
            titulo,
            completada: false
        };
        tareas.push(nuevaTarea);
        return nuevaTarea;
    },
    
    // Actualizar tarea
    async actualizar(id, datos) {
        await delay(400);
        const index = tareas.findIndex(t => t.id === id);
        if (index === -1) {
            throw new Error(`Tarea con ID ${id} no encontrada`);
        }
        tareas[index] = { ...tareas[index], ...datos };
        return tareas[index];
    },
    
    // Eliminar tarea
    async eliminar(id) {
        await delay(300);
        const index = tareas.findIndex(t => t.id === id);
        if (index === -1) {
            throw new Error(`Tarea con ID ${id} no encontrada`);
        }
        const tareaEliminada = tareas.splice(index, 1)[0];
        return tareaEliminada;
    },
    
    // Operaciones en lote
    async crearMultiples(titulos) {
        await delay(800);
        const nuevasTareas = titulos.map(titulo => ({
            id: nextId++,
            titulo,
            completada: false
        }));
        tareas.push(...nuevasTareas);
        return nuevasTareas;
    }
};

// UI Manager
class TaskManagerUI {
    constructor() {
        this.container = this.crearUI();
        this.cargarTareas();
    }
    
    crearUI() {
        const container = document.createElement('div');
        container.style.cssText = `
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        `;
        
        container.innerHTML = `
            <h2>Task Manager Asíncrono</h2>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="nueva-tarea" placeholder="Nueva tarea..." style="width: 70%; padding: 10px; margin-right: 10px;">
                <button id="agregar-tarea" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Agregar</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button id="cargar-tareas" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Cargar Tareas</button>
                <button id="crear-multiples" style="padding: 10px 20px; background: #ffc107; color: black; border: none; border-radius: 5px; cursor: pointer;">Crear Múltiples</button>
            </div>
            
            <div id="loading" style="display: none; text-align: center; padding: 20px; color: #666;">
                <i class="fas fa-spinner fa-spin"></i> Cargando...
            </div>
            
            <div id="tareas-lista"></div>
        `;
        
        document.body.appendChild(container);
        this.configurarEventos();
        return container;
    }
    
    configurarEventos() {
        document.getElementById('agregar-tarea').addEventListener('click', () => this.agregarTarea());
        document.getElementById('nueva-tarea').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.agregarTarea();
        });
        document.getElementById('cargar-tareas').addEventListener('click', () => this.cargarTareas());
        document.getElementById('crear-multiples').addEventListener('click', () => this.crearMultiples());
    }
    
    mostrarLoading(mostrar = true) {
        document.getElementById('loading').style.display = mostrar ? 'block' : 'none';
    }
    
    async cargarTareas() {
        try {
            this.mostrarLoading(true);
            const tareas = await taskAPI.obtenerTodas();
            this.renderizarTareas(tareas);
        } catch (error) {
            this.mostrarError('Error cargando tareas:', error.message);
        } finally {
            this.mostrarLoading(false);
        }
    }
    
    async agregarTarea() {
        const input = document.getElementById('nueva-tarea');
        const titulo = input.value.trim();
        
        if (!titulo) return;
        
        try {
            this.mostrarLoading(true);
            const nuevaTarea = await taskAPI.crear(titulo);
            input.value = '';
            await this.cargarTareas();
            console.log('Tarea creada:', nuevaTarea);
        } catch (error) {
            this.mostrarError('Error creando tarea:', error.message);
        } finally {
            this.mostrarLoading(false);
        }
    }
    
    async toggleTarea(id) {
        try {
            const tarea = await taskAPI.obtenerPorId(id);
            await taskAPI.actualizar(id, { completada: !tarea.completada });
            await this.cargarTareas();
        } catch (error) {
            this.mostrarError('Error actualizando tarea:', error.message);
        }
    }
    
    async eliminarTarea(id) {
        try {
            await taskAPI.eliminar(id);
            await this.cargarTareas();
        } catch (error) {
            this.mostrarError('Error eliminando tarea:', error.message);
        }
    }
    
    async crearMultiples() {
        const titulos = ['Tarea 1', 'Tarea 2', 'Tarea 3'];
        
        try {
            this.mostrarLoading(true);
            const nuevasTareas = await taskAPI.crearMultiples(titulos);
            await this.cargarTareas();
            console.log('Múltiples tareas creadas:', nuevasTareas);
        } catch (error) {
            this.mostrarError('Error creando múltiples tareas:', error.message);
        } finally {
            this.mostrarLoading(false);
        }
    }
    
    renderizarTareas(tareas) {
        const lista = document.getElementById('tareas-lista');
        lista.innerHTML = '';
        
        tareas.forEach(tarea => {
            const tareaDiv = document.createElement('div');
            tareaDiv.style.cssText = `
                display: flex;
                align-items: center;
                padding: 10px;
                margin: 5px 0;
                border: 1px solid #eee;
                border-radius: 5px;
                background: ${tarea.completada ? '#d4edda' : 'white'};
            `;
            
            tareaDiv.innerHTML = `
                <input type="checkbox" ${tarea.completada ? 'checked' : ''} style="margin-right: 10px;">
                <span style="flex: 1; text-decoration: ${tarea.completada ? 'line-through' : 'none'};">${tarea.titulo}</span>
                <button style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">Eliminar</button>
            `;
            
            // Event listeners
            const checkbox = tareaDiv.querySelector('input[type="checkbox"]');
            const btnEliminar = tareaDiv.querySelector('button');
            
            checkbox.addEventListener('change', () => this.toggleTarea(tarea.id));
            btnEliminar.addEventListener('click', () => this.eliminarTarea(tarea.id));
            
            lista.appendChild(tareaDiv);
        });
    }
    
    mostrarError(mensaje, detalle) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
        `;
        errorDiv.innerHTML = `<strong>Error:</strong> ${mensaje} ${detalle}`;
        document.getElementById('tareas-lista').appendChild(errorDiv);
    }
}

// Inicializar la aplicación
const taskManager = new TaskManagerUI();</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Navegación entre módulos -->
    <section class="module-navigation">
        <div class="container">
            <div class="nav-buttons">
                <a href="modulo3-dom.html" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i> Módulo Anterior
                </a>
                <a href="index.html#modules" class="btn btn-primary">
                    <i class="fas fa-home"></i> Ver Todos los Módulos
                </a>
                <a href="modulo5-frameworks.html" class="btn btn-outline">
                    Siguiente Módulo <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>JavaScript Academy</h3>
                    <p>Aprende JavaScript desde cero hasta nivel profesional con ejemplos prácticos y ejercicios interactivos.</p>
                </div>
                <div class="footer-section">
                    <h4>Módulos</h4>
                    <ul>
                        <li><a href="modulo1-fundamentos.html">Fundamentos</a></li>
                        <li><a href="modulo2-moderno.html">JavaScript Moderno</a></li>
                        <li><a href="modulo3-dom.html">DOM Manipulation</a></li>
                        <li><a href="modulo4-asincrono.html">Programación Asíncrona</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Recursos</h4>
                    <ul>
                        <li><a href="index.html#projects">Proyectos</a></li>
                        <li><a href="index.html#resources">Recursos</a></li>
                        <li><a href="index.html#contact">Contacto</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 JavaScript Academy. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Funciones de modal
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevenir scroll
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restaurar scroll
            }
        }

        // Estado del módulo
        let moduleProgress = 0;
        let completedLessons = new Set();
        let currentSection = 'callbacks';

        // Funciones de progreso
        function updateProgress() {
            const totalLessons = 6;
            const progress = (completedLessons.size / totalLessons) * 100;
            moduleProgress = Math.round(progress);
            
            const progressFill = document.getElementById('moduleProgress');
            const progressPercentage = document.querySelector('.progress-percentage');
            
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
            if (progressPercentage) {
                progressPercentage.textContent = progress + '%';
            }
        }

        function markLessonComplete(lessonId) {
            completedLessons.add(lessonId);
            updateProgress();
            
            const navItem = document.querySelector(`[data-section="${lessonId}"]`);
            if (navItem) {
                const statusIcon = navItem.querySelector('.nav-item-status i');
                statusIcon.className = 'fas fa-check-circle';
                statusIcon.style.color = '#28a745';
            }
        }

        // Funciones de navegación
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const toggleIcon = section.previousElementSibling.querySelector('.toggle-icon');
            
            if (section.classList.contains('collapsed')) {
                section.classList.remove('collapsed');
                toggleIcon.style.transform = 'rotate(180deg)';
            } else {
                section.classList.add('collapsed');
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }

        function showExampleTab(lesson, tab) {
            const tabContents = document.querySelectorAll(`#${lesson}-example .example-tab-content`);
            const tabButtons = document.querySelectorAll(`#${lesson}-example .tab-btn`);
            
            tabContents.forEach(content => content.classList.remove('active'));
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(`${lesson}-${tab}`).classList.add('active');
            event.target.classList.add('active');
        }

        // Funciones de código
        function runCode(codeId) {
            const codeElement = document.getElementById(codeId);
            const outputId = codeId.replace('-code', '-output');
            const outputElement = document.getElementById(outputId);
            
            if (!codeElement || !outputElement) return;
            
            const code = codeElement.textContent;
            
            const originalLog = console.log;
            let output = '';
            console.log = function(...args) {
                output += args.join(' ') + '\n';
                originalLog.apply(console, args);
            };
            
            try {
                eval(code);
                outputElement.innerHTML = `<pre class="output-content">${output || 'Código ejecutado correctamente'}</pre>`;
                outputElement.style.display = 'block';
            } catch (error) {
                outputElement.innerHTML = `<pre class="output-error">Error: ${error.message}</pre>`;
                outputElement.style.display = 'block';
            } finally {
                console.log = originalLog;
            }
        }

        // Funciones interactivas
        function executeCallback() {
            const operation = document.getElementById('interactive-operation').value;
            const numbersInput = document.getElementById('interactive-numbers').value;
            const output = document.getElementById('interactive-output');
            
            const numbers = numbersInput.split(',').map(n => parseInt(n.trim()));
            
            let result = '';
            let callbackFunction = '';
            
            switch (operation) {
                case 'sum':
                    callbackFunction = 'const sumar = (arr) => arr.reduce((acc, n) => acc + n, 0);';
                    result = `Suma: ${numbers.reduce((acc, n) => acc + n, 0)}`;
                    break;
                case 'multiply':
                    callbackFunction = 'const multiplicar = (arr) => arr.reduce((acc, n) => acc * n, 1);';
                    result = `Multiplicación: ${numbers.reduce((acc, n) => acc * n, 1)}`;
                    break;
                case 'filter':
                    callbackFunction = 'const filtrarPares = (arr) => arr.filter(n => n % 2 === 0);';
                    result = `Pares: [${numbers.filter(n => n % 2 === 0).join(', ')}]`;
                    break;
                case 'async':
                    callbackFunction = 'setTimeout(() => console.log("Operación asíncrona completada"), 1000);';
                    result = 'Operación asíncrona iniciada (ver consola)';
                    setTimeout(() => {
                        output.innerHTML += `<div class="success">✅ Operación asíncrona completada</div>`;
                    }, 1000);
                    break;
            }
            
            output.innerHTML = `
                <div class="success">
                    <h5>✅ Callback Ejecutado</h5>
                    <pre class="object-display">${callbackFunction}</pre>
                    <p><strong>Resultado:</strong> ${result}</p>
                </div>
            `;
        }

        function createPromise() {
            const operationName = document.getElementById('interactive-operation-name').value;
            const time = parseInt(document.getElementById('interactive-time').value);
            const success = document.getElementById('interactive-success').value === 'true';
            const output = document.getElementById('interactive-output');
            
            if (!operationName || !time) {
                output.innerHTML = '<div class="error">Por favor, completa todos los campos</div>';
                return;
            }
            
            const promise = new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (success) {
                        resolve(`${operationName} completada exitosamente en ${time}ms`);
                    } else {
                        reject(new Error(`${operationName} falló después de ${time}ms`));
                    }
                }, time);
            });
            
            output.innerHTML = `
                <div class="success">
                    <h5>✅ Promesa Creada</h5>
                    <p>Ejecutando promesa...</p>
                    <div id="promise-result"></div>
                </div>
            `;
            
            promise
                .then(result => {
                    document.getElementById('promise-result').innerHTML = `
                        <div class="success">✅ Éxito: ${result}</div>
                    `;
                })
                .catch(error => {
                    document.getElementById('promise-result').innerHTML = `
                        <div class="error">❌ Error: ${error.message}</div>
                    `;
                });
        }

        function simulateAsyncAwait() {
            const operationsCount = parseInt(document.getElementById('interactive-operations-count').value);
            const executionType = document.getElementById('interactive-execution-type').value;
            const output = document.getElementById('interactive-output');
            
            const operations = Array.from({ length: operationsCount }, (_, i) => 
                new Promise(resolve => {
                    const delay = 1000 + (i * 500);
                    setTimeout(() => {
                        resolve(`Operación ${i + 1} completada en ${delay}ms`);
                    }, delay);
                })
            );
            
            output.innerHTML = `
                <div class="success">
                    <h5>✅ Simulando Async/Await</h5>
                    <p>Tipo: ${executionType === 'sequential' ? 'Secuencial' : 'Paralelo'}</p>
                    <p>Operaciones: ${operationsCount}</p>
                    <div id="async-result"></div>
                </div>
            `;
            
            const startTime = Date.now();
            
            if (executionType === 'sequential') {
                // Simular ejecución secuencial
                (async () => {
                    const results = [];
                    for (let i = 0; i < operations.length; i++) {
                        const result = await operations[i];
                        results.push(result);
                        document.getElementById('async-result').innerHTML += 
                            `<div class="success">${result}</div>`;
                    }
                    const totalTime = Date.now() - startTime;
                    document.getElementById('async-result').innerHTML += 
                        `<div class="success"><strong>Tiempo total secuencial: ${totalTime}ms</strong></div>`;
                })();
            } else {
                // Simular ejecución paralela
                Promise.all(operations).then(results => {
                    results.forEach(result => {
                        document.getElementById('async-result').innerHTML += 
                            `<div class="success">${result}</div>`;
                    });
                    const totalTime = Date.now() - startTime;
                    document.getElementById('async-result').innerHTML += 
                        `<div class="success"><strong>Tiempo total paralelo: ${totalTime}ms</strong></div>`;
                });
            }
        }

        // Observador de intersección para progreso
        function setupProgressObserver() {
            const lessons = document.querySelectorAll('.lesson-section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const lessonId = entry.target.dataset.lesson;
                        if (lessonId && !completedLessons.has(lessonId)) {
                            setTimeout(() => {
                                markLessonComplete(lessonId);
                            }, 3000);
                        }
                    }
                });
            }, { threshold: 0.5 });

            lessons.forEach(lesson => observer.observe(lesson));
        }

        // Navegación suave
        function setupSmoothNavigation() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                        
                        const sectionId = target.id;
                        if (sectionId) {
                            currentSection = sectionId;
                            updateNavigationState();
                        }
                    }
                });
            });
        }

        function updateNavigationState() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeItem = document.querySelector(`[data-section="${currentSection}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        function updateBreadcrumb() {
            const currentPage = document.getElementById('current-page');
            if (currentPage) {
                currentPage.textContent = 'Programación Asíncrona';
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            updateBreadcrumb();
            setupSmoothNavigation();
            setupProgressObserver();
            Prism.highlightAll();
            updateNavigationState();
        });

        // Funciones globales
        window.toggleCode = function(codeId) {
            const codeBlock = document.getElementById(codeId);
            if (codeBlock.style.display === 'none') {
                codeBlock.style.display = 'block';
                Prism.highlightAll();
            } else {
                codeBlock.style.display = 'none';
            }
        };

        window.toggleSection = toggleSection;
        window.showExampleTab = showExampleTab;
        window.runCode = runCode;
        window.executeCallback = executeCallback;
        window.createPromise = createPromise;
        window.simulateAsyncAwait = simulateAsyncAwait;
    </script>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab-button" id="fabButton">
            <i class="fas fa-bars"></i>
        </button>
        <div class="fab-menu" id="fabMenu">
            <a href="#" class="fab-item" onclick="scrollToTop(); return false;">
                <i class="fas fa-arrow-up"></i>
                <span>Ir Arriba</span>
            </a>
            <a href="#callbacks" class="fab-item">
                <i class="fas fa-sync"></i>
                <span>Lección 1: Callbacks</span>
            </a>
            <a href="#promises" class="fab-item">
                <i class="fas fa-clock"></i>
                <span>Lección 2: Promesas</span>
            </a>
            <a href="#async-await" class="fab-item">
                <i class="fas fa-hourglass-half"></i>
                <span>Lección 3: Async/Await</span>
            </a>
        </div>
    </div>

    <script>
        // FAB functionality
        const fabButton = document.getElementById('fabButton');
        const fabMenu = document.getElementById('fabMenu');
        
        fabButton.addEventListener('click', () => {
            fabMenu.classList.toggle('active');
            fabButton.classList.toggle('active');
        });

        // Close FAB menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.fab-container')) {
                fabMenu.classList.remove('active');
                fabButton.classList.remove('active');
            }
        });

        // Scroll to top function
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Close FAB menu when clicking on a lesson link
        document.querySelectorAll('.fab-item[href^="#"]').forEach(link => {
            link.addEventListener('click', () => {
                fabMenu.classList.remove('active');
                fabButton.classList.remove('active');
            });
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                // Stop any playing speech
                if (currentSpeech) {
                    speechSynthesis.cancel();
                    currentSpeech = null;
                }
            }
        });

        // Text-to-Speech functionality
        let currentSpeech = null;
        
        function readModalContent(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            const audioBtn = modal.querySelector('.audio-btn');
            const modalBody = modal.querySelector('.modal-body');
            
            if (!modalBody) return;
            
            // Stop current speech if playing
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                audioBtn.classList.remove('playing');
                audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                return;
            }
            
            // Get text content from modal body
            let textToRead = '';
            
            // Extract text from headings and paragraphs, skip code blocks
            const elements = modalBody.querySelectorAll('h3, h4, p, li, ul, ol');
            elements.forEach(element => {
                // Skip code blocks
                if (element.closest('pre') || element.closest('code')) return;
                
                const text = element.textContent.trim();
                if (text) {
                    textToRead += text + '. ';
                }
            });
            
            if (!textToRead) {
                textToRead = 'No hay contenido de texto para leer.';
            }
            
            // Create speech synthesis
            const utterance = new SpeechSynthesisUtterance(textToRead);
            utterance.lang = 'es-ES';
            utterance.rate = 1.1;
            utterance.pitch = 1;
            utterance.volume = 0.9;
            
            // Update button state
            audioBtn.classList.add('playing');
            audioBtn.innerHTML = '<i class="fas fa-stop"></i>';
            
            // Handle speech events
            utterance.onstart = () => {
                currentSpeech = utterance;
            };
            
            utterance.onend = () => {
                currentSpeech = null;
                audioBtn.classList.remove('playing');
                audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            };
            
            utterance.onerror = () => {
                currentSpeech = null;
                audioBtn.classList.remove('playing');
                audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            };
            
            // Start speaking
            speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
